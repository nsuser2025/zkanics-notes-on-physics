#### ATAT インストール
<p>
事前に $(HOME)/ATAT/3.50/bin のディレクトリを作っておく.</br>
makefile の BINDIR=$(HOME)/ATAT/3.50/bin にする.</br>
make & make install
</p>

---

#### MAPS（MIT Ab-initio Phase Stability）
<p>
クラスター選択アルゴリズムにより空間的にコンパクトなクラスターを優先的に選び出す.</br> 
ある多体クラスターをクラスター展開に用いる場合は, その低次のクラスター（サブクラスター）
が全て含まれていることが条件. MAPS 以外にも遺伝的アルゴリズムを用いる手法などがある.</br>
Ref. Zarkevich2004_Phys.Rev.Lett.vol92.255702
</p>

---

#### SQS
<p>
理想ランダム固溶体の相関関数を有限サイズの超格子で再現するように設計された構造. </br>
</p>

---

#### rndstr.in
<p>
corrdump のインプットファイル.
corrdump コマンドは格子ファイル rndstr.in を読み込み,
対称性とクラスターを計算する. 非常に大きな周期セルを定義しない限り,
通常このコマンドはすぐに終了する（大きなセルの場合は clusters.out が巨大になり, 
数時間以上かかることもある).
</p>
  
<p>
Line 1: ベクトルの長さ（$a, b, c$）と角度（$\alpha, \beta, \gamma$）</br>
$\rightarrow$ デカルト座標系におけるユニットセルを定義する.
POSCAR ファイルのように 3×3 の行列でユニットセルを表す3行の記述に置き換えることも可能.
ユニットセルの目的は, 周期セルとサイトを記述するための座標系を提供すること.</br>
Line 3 - 5: 対象とする材料の周期性を表す最小のスーパーセル（基本構造）.
例えば、FCCのランダム固溶体には1原子のFCCプリミティブセルが必要であり、
HCPのランダム固溶体には2原子のHCPプリミティブセル、
そして $L1_2$ 合金には4原子の FCC ユニットセルが必要となります。
周期セルはユニットセルを用いて表現されます。
つまり、周期セルのデカルト座標は $B$ と $A$ の積になります。
Line 6-: 原子濃度を指定した格子サイト. 各成分の濃度は有効数字 6 桁を超えない値で,
各サイトにおける原子濃度の合計が常に 1 になるように指定する.  
</p>

<p>
最終的な SQS のサイズや形状は mcsqs が制御するので,
実際の材料の格子定数を記載する必要はない.</br>
オプション -2 や -3 のカットオフを指定する際,
判断が容易になるので格子定数は 1 が使用されることが多い.
</p>

<p>
<u>FCC 型 Cantor 合金</u></br>  
1 1 1 90 90 90</br>
.0 .5 .5</br>
.5 .0 .5</br>
.5 .5 .0</br>
.0 .0 .0 Cr=0.2,Mn=0.2,Fe=0.2,Co=0.2,Ni=0.2</br>
</p>

<p>
<u>L1$_{2}$ FCC 構造の規則合金</u></br>
1 1 1 90 90 90</br>
1 0 0</br>
0 1 0</br>
0 0 1</br>
.0 .0 .0 Cr</br>
.0 .5 .5 Ni=.333333,Fe=.333333,Co=.333334</br>
.5 .0 .5 Ni=.333333,Fe=.333333,Co=.333334</br>
.5 .5 .0 Ni=.333333,Fe=.333333,Co=.333334</br>
</p>

<p>
<u>HCP ランダム固溶体</u></br>
1 1 1.633 90 90 60</br>
1 0 0</br>
0 1 0</br>
0 0 1</br>
.000000 .000000 .0 Ni=.25,Fe=.25,Cr=.25,Co=.25</br>
.666667 .666667 .5 Ni=.25,Fe=.25,Cr=.25,Co=.25</br>
</p>

<p>
<u>D0$_{19}$ HCP 構造の規則合金</u></br>
1 1 1.633 90 90 60</br>
2 0 0</br>
0 2 0</br>
0 0 1</br>
0.000000 0.000000 0.0 Cr</br>
0.000000 1.000000 0.0 Ni=.333333,Fe=.333333,Co=.333334</br>
1.000000 0.000000 0.0 Ni=.333333,Fe=.333333,Co=.333334</br>
1.000000 1.000000 0.0 Ni=.333333,Fe=.333333,Co=.333334</br>
0.666667 0.666667 0.5 Cr</br>
1.666667 0.666667 0.5 Ni=.333333,Fe=.333333,Co=.333334</br>
0.666667 1.666667 0.5 Ni=.333333,Fe=.333333,Co=.333334</br>
1.666667 1.666667 0.5 Ni=.333333,Fe=.333333,Co=.333334</br>
</p>

---

#### corrdump オプション
<p>
-n（n = 2,3,4）: n 体相関関数を計算する際のカットオフ</br>
格子定数を 1 とした FCC ランダム固溶体では </br>
第 1 近接距離: $\frac{\sqrt{2}}{2} \approx 0.71$ </br>
第 2 近接距離: $1.0$ </br> 
第 3 近接距離: $\sqrt{1.5} \approx 1.22$ </br>
第 2 近接までの相関を考慮したい場合は, カットオフを 1.0 と 1.2
の間の任意の値に設定する. すべてに当てはまる一般的なルールはないが,
カットオフを高く設定するほど最終的な構造のランダム性は向上するものの,
mcsqs が完全に一致する SQS を見つけるのに非常に長い時間がかかってしまう.
そこで, まず低いカットオフ値から始め, 良い SQS が得られるまで値を徐々に増やしていく.
</p>

---

#### mcsqs
<p>
定義されたスーパーセルを用いて, モンテカルロ法から SQS を探索する.  
</p>

<p>
SQS に含まれる原子数（XX）は, rndstr.in で定義されたサイト数の倍数であり,
なおかつ全ての元素の原子数が整数になるような値にする.
例えば, 三元系の等原子組成 L1${_2}$ 合金（rndstr.in では4サイト）の場合,
SQS には少なくとも 12 個の原子が含まれている必要があります.

mcsqs コマンドは、材料の複雑さやカットオフ値の設定によっては無限に走り続けることがあります。
通常、カットオフには第2近接シェルまで含めるべきですが、それ以上含める必要はほとんどありません。
なぜなら、もし第2シェルの相関関数の不一致（ミスマッチ）が完璧でない場合、
その誤差がより外側のシェルの誤差を圧倒してしまう可能性が高いからです。

二元系合金の SQS は数秒で探索できるが, 五元系ランダム合金では,
Perfect_match SQS は見つからない可能性もある.
それどころか, 目的関数が十分低い SQS を見つけるだけでも数日から数週間かかることもある.
どんな構造を SQS として取り出すかの明確な基準はないが,
格子ベクトルが非常に長く, ベクトル間の角度が非常に小さい SQS は DFT
計算を行うモデルとして適していないから使わないほうがいい.  
</p>

#### sqscell.out を用いた探索

<p>
SQSの形状を制御することも可能です。
ここで、もう一つ注意を払うべきファイルがあります。
それが sqscell.out です。
このファイルは mcsqs コマンドによって生成されます。
典型的な sqscell.out の内容は以下の通りです：</br>
2</br>
</br>
 3 -2  4</br>
 3 -4  2</br>
-2  4 -3</br>
</br>
 3  0  0</br>
 0  3  0</br>
-1 -2  2</br>
</p>

<p>
最初の行はセル形状の総数を示し、その後に空行が続きます。次の3行は SQS の1つのセル形状を定義します。
この 3x3 行列はデカルト座標（Cartesian coordinates）を使用しており、
rndstr.in のユニットセルで表現されたものではないことに注意してください。
もし SQS に使用する正確なセルを固定したい場合は、
その格子ベクトルを sqscell.out に記述します。
これにより、mcsqs コマンドにパラメータを追加することで（これは -n xx パラメータを上書きします）、
SQS の生成を制限することができます。:mcsqs -rc  
</p>

<p>
2x2x2のFCCスーパーセル（32原子）を構築する場合、
sqscell.out に記述する行列は非常にシンプルで直感的なものになります。</br>  
1</br>
</br>
2 0 0</br>
0 2 0</br>
0 0 2</br>
</p>

---

#### Search for SQS with equi-length vectors
<p>
SQS の形状を制御する最も大きな理由は、その形状を可能な限り立方体に近づけることにあります。
これにより、DFT 計算において等方的な K 点（K-points）の設定が可能になり,
対称性に関連するトラブルも少なくなります。
これは、ユーザーが事前に使用したい正確な形状を知っている場合とは異なります.
今回のように、セルの形状がまだ決まっていない場合を考えてみましょう。
例えば、36原子の4元系等原子比 BCC SQS を生成したいとします。
このとき、可能な限り立方体に近いセルの格子ベクトルを（頭の中で）想像するのは困難です。

この目的を達成するために、以下の手順を踏んでください：
mcsqs -n 36 を実行します。
sqscell.out ファイルが生成されたら、すぐに mcsqs のプロセスを停止してください。
sqscell.out ファイルを整理し、格子ベクトルの長さが等しい（あるいは近い）セル形状だけを残します。
もし等しい長さのセルが複数ある場合は、その中でも最も長さが短いものを選んでください。
なぜなら、それが最も立方体に近い形状を意味するからです。
mcsqs -rc で再スタートします。
手順2は退屈な作業ですので、そのためのPythonコードを作成しました：  
</p>

---

#### POSCAR への変換
<p>
install: c++ ./sqs2poscar.cpp -o ./sqs2poscar </br> 
sqs2poscar 
</p>

---

#### mcsqs の出力ファイル
<p>
sqscell.out, rndstrgrp.out, bestsqs.out, bestcorr.out, mcsqs.log
sqscell.out ファイルについては、以前に紹介しました。
rndstrgrp.out: rndstr.in ファイルを再構成したものです。 
</p>
<p>
<u>bestsqs.out</u> </br>
探索過程で得られた構造のうち, 目的関数が負に最も大きい SQS のみが保存される.
フォーマットは rndstr.in ファイルとほぼ同じだが, bestsqs.out では全てのサイトが
元素の混合状態ではなく, 特定の原子が確定している.
</p>
<p>
<u>bestcorr.out</u>
2	0.866025	-0.027778	0.000000	-0.027778</br>
2	0.866025	-0.013889	-0.000000	-0.013889</br>
2	0.866025	0.000000	0.000000	0.000000</br>
2	0.866025	0.027778	0.000000	0.027778</br>
2	0.866025	0.000000	-0.000000	0.000000</br>
2	0.866025	0.000000	0.000000	0.000000</br>
2	1.000000	-0.009259	0.000000	-0.009259</br>
2	1.000000	-0.000000	-0.000000	-0.000000</br>
2	1.000000	-0.018519	0.000000	-0.018519</br>
2	1.000000	-0.027778	0.000000	-0.027778</br>
2	1.000000	0.037037	-0.000000	0.037037</br>
2	1.000000	0.000000	0.000000	0.000000</br>
Objective_function= -0.703988</br></br>  
ターゲットとなる理想ランダム固溶体と, それに対応する bestsqs.out の相関関数が含まれている.
このファイルは5つの列と、最終行の Objective_function で構成されています。
Column 1: n 体相関</br>
Column 2: 計算に含まれる近接原子間の距離</br>
Column 3: SQS の相関関数</br>
Column 4: rndstr.in で定義された合金の相関関数</br>
Column 5: Col. 3 と Col. 4 の差 $\rightarrow$ 理想的な SQS に達するとゼロになる.
意図した通りの近傍シェルを含んでいるか確認する.
例では第 2 近接まで表示されており, 2 つの近接シェルが計算に含まれていることがわかる.
これらの距離の値は、定義された格子定数（1単位）とも一致しています。
最終行: SQS の目的関数（Objective_function）$\rightarrow$
負に大きいほど, その SQS は理想ランダム固溶体とみなすことができる.
すべての相関関数がターゲットと完全に一致した場合, Objective_function
には Perfect_match と表示される.  
</p>
<p>
<u>mcsqs.log</u> </br>
新しい SQS を見つけるたびに,　その目的関数（objective function）と bestcorr.out
の第 5 列にあるすべての数値が保存される.  
</p>

---

#### SQS の妥当性
<p>
注目している物性に対して十分な精度があることを検証することで SQS の有効性を確認する.
有効性を保証する目的関数の基準値があるわけではないので,
目的関数が小さな SQS だけが常に有効であるということではない. 
例えば, 目的関数の値が -0.95 の SQS は, -0.85 のものより優れていると判断されるが,
前者の生成に 3 週間かかり, 後者がわずか 5 日で済んだとして, 結果的に両者とも「十分な質」である可能性もある.
数学的な Perfect Match を待つのではなく, 現実的な時間で生成した SQS を使用する（妥協点の見極め）
</p>
<p>
SQS を生成する際、rndstr.in で元素が割り当てられますが、もし2つの元素が「等価」
であれば（つまり、常に同じサイトで同じ濃度を持つ場合）、それらを入れ替えることが可能です。
例えば、等原子比の FCC SQS では、すべての元素が等価であるため、
どの2つの元素も入れ替えることができます。$L1_2$ 型 SQS の場合、
Bサイト（前述の rndstr.in の例では Ni, Co, Fe）にある3つの元素は等価です。
このように等価な元素を入れ替えることで、同じ SQS から複数の「置換パターン（permutation）」を得ることができます。
良い SQS とは、これらすべての置換パターンにおいて、性能（物性値）が近いことが期待されます。
最も本質的な物性は、当然ながら「全自由エネルギー」です。
理想的には、同じ SQS のすべての置換パターンの全自由エネルギーは等しくなります。
しかし、ペアやトリプレットなどの相関関数を、十分に大きなカットオフですべて完璧に一致させることはほぼ不可能であるため、
エネルギーが完全に一致することはまずありません。
置換パターンごとのエネルギーは変動（ゆらぎ）します。
この変動が小さいか大きいかは、材料、セルサイズ、および相関関数に依存します（特に材料の影響が最も顕著です。）。
エネルギーのばらつきがあなたの研究の結論に影響を与えない限り、より膨大な時間をかけて 
SQS を生成し、小さな変動を追求する必要はありません。  
</p>

---

#### Niu2015_Appl.Phys.Lett.vol106.161906
<p>
<u> Fig. 2 で SQS の妥当性を検証</u> </br>
</p>
<p>
この図では、等原子比のNiFeCrCo合金において、「磁気状態（常磁性/強磁性）」と
「元素の並べ替え（Permutation）」が、全エネルギーにどのような影響を与えるかをプロットしています。
エネルギーのばらつき（Energy Scattering）: 同じSQS構造内で、
元素（Ni, Fe, Cr, Co）の配置を入れ替えた複数のパターンについて計算しています。
もしSQSが完璧にランダムであれば、どの入れ替えパターンでもエネルギーは一定になるはずですが、
実際にはわずかにばらつきます。
物理的な結論への影響: 図を見ると、常磁性（DLM）状態でのエネルギーのばらつきに比べ、
特定の磁気的秩序が生まれた際のエネルギー変化の方が支配的であることが示されています。
つまり、「SQSの不完全さに起因する誤差」よりも「調べたい物理現象（磁気駆動の規則化）」
によるエネルギー変化の方が十分に大きいため、
この SQS は研究の結論を導くのに十分な質（Good Enough）であると証明.
不確かさの定量的評価: 元素を入れ替えた複数のパターン（Permutations）で計算を行い、エネルギーの「エラーバー」を明示。
結論のロバスト性: 「SQSの誤差（ノイズ）」と「物理現象（シグナル）」を比較し、シグナルの方が大きいことを確認。  
</p>
<p>
全自由エネルギー以外にも、他の物性を用いて SQS が十分に良いかどうかを判断することができます。
上（原文）に示したのは同じ論文の Fig. 1 です。2つのサブプロットは異なる2つの SQS から得られたものです。
左側は24原子の小さな SQS、右側は120原子の大きな SQS です。
どちらの SQS も同じ FCC ランダム合金を対象としており, 相関関数の設定も同様.
それぞれのサブプロットでは、すべての置換パターンにおける全原子の磁気モーメントを収集し、
局所的な近傍の磁気環境の関数としてプロットしています。右側のサブプロットは原子数が4倍多いため、
プロットの密度が高くなっています。
ここで私が示したいのは、これら2つのサブプロットが同様の傾向を示しているということであり、
これが小さい方の SQS の正確さを証明しています。
</p>

#### Cantor Alloy 

<p>
corrdump -l=rndstr.in -ro -noe -nop -clus -2=1.1 -3=1.1 -4=1.1  
</p>
